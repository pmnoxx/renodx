// common.hlsl v0.0

#ifndef COMMON_H_
#define COMMON_H_

#include "./shared.h"

#define INV_REINHARD 2.f


float ReinhardScalable(float color, float channel_max = 1.f, float channel_min = 0.f, float gray_in = 0.18f, float gray_out = 0.18f) {
  /*float exposure = (channel_max * (channel_min * gray_out + channel_min - gray_out));
                   / max(gray_in * (gray_out - channel_max));

  float numerator = -channel_max * (channel_min * color + channel_min - color);
  float denominator = (exposure * (channel_max - color));
  return renodx::math::DivideSafe(numerator, denominator, renodx::math::FLT16_MAX); */

  float numerator = color * (channel_max - 0.18f);
  float denominator = max(.0001f, channel_max - color);
  return renodx::math::DivideSafe(numerator, denominator, 10.f);
}

#define SCENE_TYPE_UNKNOWN 0
#define SCENE_TYPE_2D_CHARACTER 1
#define SCENE_TYPE_2D_BACKGROND 2
#define SCENE_TYPE_3D 3


float4 debug_mode(float4 color, float2 pos, float shift_y = 0.f) {
    float2 box = float2(0.99f, 0.99f - shift_y);
    float2 dim = float2(0.01f, 0.01f);

    if (length(pos >= box && pos <= box + dim) > 1.f) {
        float part = (pos.x - box.x) / dim.x;
        if (part < 1. / 3.f) {
            return float4(1.f, 0.f, 0.f, 1.f);
        }
        if (part < 2. / 3.f) {
            return float4(0.f, 1.f, 0.f, 1.f);
        }     
        return float4(0.f, 0.f, 1.f, 1.f);
    }

    return color;
}
  


float3 ToneMapPassWrapper(float3 color) {
    if (RENODX_ENABLE_UI_TONEMAPPASS) {
        return color;
    }
    return renodx::draw::ToneMapPass(color);
}

float3 ToneMapPassWrapper(float3 untonemapped, float3 graded_sdr_color) {
    if (RENODX_ENABLE_UI_TONEMAPPASS) {
        return graded_sdr_color;
    }
    return renodx::draw::ToneMapPass(untonemapped, graded_sdr_color);
}

float3 ToneMapPassWrapper(float3 untonemapped, float3 graded_sdr_color, float3 neutral_sdr_color) {
    if (RENODX_ENABLE_UI_TONEMAPPASS) {
        return graded_sdr_color;
    }
    return renodx::draw::ToneMapPass(untonemapped, graded_sdr_color, neutral_sdr_color);
}

#endif
